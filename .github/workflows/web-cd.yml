name: Continue Deployment for web
on:
  workflow_run:
    workflows: ["Continue Integration for web"]
    types: [completed]
    branches: [master, dev]

jobs:
  deploy_production:
    runs-on: ubuntu-latest
    if: |
      github.event.workflow_run.conclusion == 'success' &&
      github.event.workflow_run.head_branch == 'master' &&
      github.event.workflow_run.event != 'pull_request'

    environment: prod

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - uses: "./.github/workflows/deploy.yml"
        with:
          ci-workflow-id: ${{ github.event.workflow_run.id }}
          channelId: "live"
          projectId: ${{ secrets.SG_WEB_FB_PROJECT_ID }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_SANDGLASS_CCCE4 }}
          repoToken: ${{ secrets.GITHUB_TOKEN }}

  deploy_dev:
    runs-on: ubuntu-latest
    if: |
      github.event.workflow_run.conclusion == 'success' &&
      github.event.workflow_run.head_branch == 'dev' &&
      github.event.workflow_run.event != 'pull_request'

    environment: staging

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - uses: "./.github/workflows/deploy.yml"
        with:
          ci-workflow-id: ${{ github.event.workflow_run.id }}
          channelId: "live"
          projectId: ${{ secrets.SG_WEB_FB_PROJECT_ID }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_SANDGLASS_DEV_2BC90 }}
          repoToken: ${{ secrets.GITHUB_TOKEN }}

  deploy_pr_preview:
    runs-on: ubuntu-latest
    if: |
      github.event.workflow_run.conclusion == 'success' &&
      github.event.workflow_run.event == 'pull_request'

    environment: staging

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - uses: "./.github/workflows/deploy.yml"
        with:
          ci-workflow-id: ${{ github.event.workflow_run.id }}
          projectId: ${{ secrets.SG_WEB_FB_PROJECT_ID }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_SANDGLASS_DEV_2BC90 }}
          repoToken: ${{ secrets.GITHUB_TOKEN }}
